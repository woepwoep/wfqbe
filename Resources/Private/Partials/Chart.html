{namespace v=FluidTYPO3\Vhs\ViewHelpers}
{namespace rs=RedSeadog\Wfqbe\ViewHelpers}

<f:comment>
<f:debug>{_all}</f:debug>
</f:comment>

<f:variable name="chartData" value="<rs:array2Chart rows='{rows}' />" />

<f:asset.script identifier="identifier-2" src="https://cdn.jsdelivr.net/npm/chart.js" priority="1" />
<f:asset.script identifier="identifier-3" >

const data = {
  labels: <f:for each="<rs:array2Chart rows='{rows}' />" as="dataSet" iteration="i" >
                  <f:if condition="{i.isFirst}" ><f:format.raw value="{dataSet}" /></f:if>
                </f:for>,
 
   datasets: [
            <f:for each="{chartFields}" as="dataSet" >
              {
              type: <f:if condition="1">'{dataSet.chartType}',</f:if>
              label: <f:if condition="1">'{dataSet.name}',</f:if>
              data: <f:if condition="1">{chartData.{dataSet.name}},</f:if>
              backgroundColor: <f:if condition="1">'{dataSet.chartColor}',</f:if>
              },
            </f:for>
        ]
};

const config = {
  data: data,
  options: {
    elements: {
      line: {
        borderWidth: 3
      }
    },
  	plugins: {
  	  title: {
  		display: true,
  		text: <f:if condition="1">'{flexformdata.caption}',</f:if>
  		font: {
            size: 18
           }
  		}
  	}
  },
};
  
var myChart = new Chart(
    document.getElementById('myChart-{cObject.uid}'),
    config
  );                                                              

</f:asset.script>
